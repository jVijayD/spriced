<div class="container">
<h1 mat-dialog-title>
    <strong>{{ action }} Entity</strong>
  </h1>
  
  <div mat-dialog-content class="{{ action !== 'Delete' ? 'content' : '' }}">
    <div class="namegrid">
      <div *ngIf="action !== 'Delete'">
        <form
          [formGroup]="entityForm"
          class="form d-flex flex-column flex-lg-row"
        >
          <div>
            <mat-form-field appearance="outline">
              <mat-label>Entity Name</mat-label>
              <input formControlName="name" matInput />
            </mat-form-field>
            <div class="error">
              <mat-error
                class="text-sm italic text-red-500"
                *ngIf="
                  entityForm.controls['name'].hasError('required') &&
                  (entityForm.controls['name'].dirty ||
                    entityForm.controls['name'].touched)
                "
                >Name is required</mat-error
              >
            </div>
          </div>
        </form>
      </div>
      <div class="ml-4">
        <mat-form-field
          appearance="outline"
          *ngIf="action !== 'Delete'; else elseTemplate"
        >
          <mat-label>Display Name</mat-label>
          <input matInput [(ngModel)]="local_data.displayName" />
        </mat-form-field>
      </div>
      <mat-checkbox
        *ngIf="action !== 'Delete'"
        checked="true"
        [(ngModel)]="local_data.autoNumberCode"
        >Auto generate Code</mat-checkbox
      >
  
      <!-- Mayur - 17 july 2023 - below code is commented as told on DSM today -->
  
      <!-- <div class="ml-4" *ngIf="action !== 'Delete'">
        <mat-form-field appearance="outline">
          <mat-label>Display Type</mat-label>
          <mat-select>
            <mat-option value="name">Name</mat-option>
            <mat-option value="id">Id</mat-option>
            <mat-option value="both">Name and Id</mat-option>
          </mat-select>
        </mat-form-field>
      </div> -->
    </div>
    <ng-template #elseTemplate>
      Sure to delete <b>{{ local_data.name }}</b
      >?
    </ng-template>
    <mat-card
      style="padding: 20px; height: 500px"
      *ngIf="action !== 'Delete'"
      class="drop-shadow"
    >
      <div class="box">
        <div class="tableBox">
          <mat-toolbar color="primary">
            <span>Add / Edit / Delete Attributes</span>
          </mat-toolbar>
          <div class="overflow-x-hidden" style="max-height: 375px">
            <table
              mat-table
              [dataSource]="attSource"
              class="mat-elevation-z8"
              #attrtable
            >
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell class="cursor-pointer" *matCellDef="let element">
                  {{ element.name }}
                </td>
              </ng-container>
  
              <ng-container matColumnDef="displayName">
                <th mat-header-cell *matHeaderCellDef>Display Name</th>
                <td mat-cell class="cursor-pointer" *matCellDef="let element">
                  {{ element.displayName || element.name }}
                </td>
              </ng-container>
  
              <ng-container matColumnDef="action" style="text-align: right">
                <th mat-header-cell *matHeaderCellDef>Action</th>
                <td
                  mat-cell
                  *matCellDef="let element"
                  class="action-link cursor-pointer"
                >
                  <div class="flex-icon">
                    <button mat-icon-button (click)="viewAtt(element)">
                      <mat-icon>visibility</mat-icon>
                    </button>
                    |
                    <button
                      mat-icon-button
                      [disabled]="element.editable === false"
                      (click)="deleteAtt(element)"
                    >
                      <mat-icon>delete</mat-icon>
                    </button>
                  </div>
                </td>
              </ng-container>
  
              <tr
                mat-header-row
                *matHeaderRowDef="displayedColumns; sticky: true"
              ></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
            </table>
          </div>
          <div
            *ngIf="attSource.length === 0"
            class="flex justify-center align-center pt-16 pb-16 bg-white"
          >
            No Records Found
          </div>
        </div>
  
        <div class="flex" style="flex-direction: column; height: 375px">
          <mat-form-field appearance="outline">
            <mat-label>Attribute Name</mat-label>
            <input
              [disabled]="attAction === 'Edit'"
              matInput
              [(ngModel)]="attDetails.name"
            />
          </mat-form-field>
  
          <mat-form-field appearance="outline">
            <mat-label>Display Name</mat-label>
            <input matInput [(ngModel)]="attDetails.displayName" />
          </mat-form-field>
          <div class="flex flex-row mb-5">
            <!-- <mat-label>Type</mat-label> -->
            <mat-radio-group
              aria-label="Select an option"
              [(ngModel)]="attDetails.type"
              [value]="type"
              (change)="radioButtonChanged($event)"
            >
              <mat-radio-button value="FREE_FORM">Free Form</mat-radio-button>
              <mat-radio-button value="LOOKUP">Domain Based</mat-radio-button>
            </mat-radio-group>
          </div>
          <mat-form-field
            appearance="outline"
            *ngIf="attDetails.type === 'LOOKUP'"
          >
            <mat-label>Entity</mat-label>
  
            <mat-select
              [(ngModel)]="attDetails.referencedTableId"
              (selectionChange)="selectedEntity($event)"
            >
              <mat-option
                *ngFor="let item of entityList"
                [value]="item.id"
                [disabled]="local_data.id === item.id"
                >{{ item.name }}</mat-option
              >
            </mat-select>
          </mat-form-field>
          <mat-checkbox
            *ngIf="attDetails.type !== 'LOOKUP'"
            class="mb-5"
            style="margin-top: 12px; margin-bottom: 21px"
            [(ngModel)]="constraintType"
            >Is Unique</mat-checkbox
          >
          <mat-form-field
            appearance="outline"
            *ngIf="attDetails.type === 'FREE_FORM'"
          >
            <mat-label>Data Type</mat-label>
            <mat-select [(ngModel)]="attDetails.dataType">
              <mat-option value="STRING_VAR">Fixed Length String</mat-option>
              <mat-option value="TEXT">Text</mat-option>
              <mat-option value="INTEGER">Number</mat-option>
              <mat-option value="LINK">Link</mat-option>
              <mat-option value="TIME_STAMP">Date Time</mat-option>
              <mat-option value="BOOLEAN">Boolean</mat-option>
            </mat-select>
          </mat-form-field>
  
          <mat-form-field
            appearance="outline"
            *ngIf="
              attDetails.dataType === 'TEXT' ||
              (attDetails.dataType === 'LINK' && attDetails.type === 'FREE_FORM')
            "
          >
            <mat-label>Length</mat-label
            ><input matInput type="number"  min="0" [(ngModel)]="attDetails.size"
          /></mat-form-field>
          <div
            *ngIf="
              attDetails.dataType === 'INTEGER' && attDetails.type === 'FREE_FORM'
            "
            style="display: contents"
          >
            <mat-form-field appearance="outline">
              <mat-label>Decimels</mat-label
              ><input
                matInput
                type="number"
                min="0"
                [(ngModel)]="attDetails.size"
            /></mat-form-field>
          </div>
          <div
            *ngIf="
              attDetails.dataType === 'TIME_STAMP' &&
              attDetails.type === 'FREE_FORM'
            "
            style="display: contents"
          >
            <mat-form-field appearance="outline"
              ><mat-label>Input Mask</mat-label>
  
              <mat-select [(ngModel)]="attDetails.formatter">
                <mat-option value="MM/dd/yy">MM/dd/yy</mat-option>
                <mat-option value="MM/dd/yyyy">MM/dd/yyyy</mat-option>
                <mat-option value="dd/MM/yy">dd/MM/yy</mat-option>
                <mat-option value="dd/MM/yyyy">dd/MM/yyyy</mat-option>
                <mat-option value="yy/MM/dd">yy/MM/dd</mat-option>
                <mat-option value="yyyy/MM/dd">yyyy/MM/dd</mat-option>
                <mat-option value="dd-MM-yy">dd-MM-yy</mat-option>
                <mat-option value="dd-MM-yyyy">dd-MM-yyyy</mat-option>
                <mat-option value="d-M-y">d-M-y</mat-option>
                <mat-option value="d-M-yyyy">d-M-yyyy</mat-option>
                <mat-option value="yy-MM-dd">yy-MM-dd</mat-option>
                <mat-option value="yyyy-MM-dd">yyyy-MM-dd</mat-option>
                <mat-option value="d-M-yy">d-M-yy</mat-option>
                <mat-option value="d-M-yyyy">d-M-yyyy</mat-option>
                <mat-option value="MM/yyyy">MM/yyyy</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <mat-form-field
            appearance="outline"
            *ngIf="
              attDetails.dataType === 'INTEGER' && attDetails.type === 'FREE_FORM'
            "
            ><mat-label>Input Mask</mat-label>
            <mat-select [(ngModel)]="attDetails.formatter">
              <mat-option value="option1">-####</mat-option>
              <mat-option value="option2">(####)</mat-option>
            </mat-select>
          </mat-form-field>
          <mat-divider></mat-divider>
          <div class="flex justify-end p-5">
            <button
              mat-flat-button
              type="button"
              color="primary"
              class="savebtn"
              (click)="updateRowData(attDetails)"
              [disabled]="
                attDetails.name === '' ||
                attDetails.name === undefined ||
                attDetails.editable === false
              "
            >
              {{ attAction }}
            </button>
            <button
              mat-flat-button
              class="savebtn ml-5"
              color="accent"
              type="button"
              (click)="clear()"
            >
              Clear
            </button>
          </div>
        </div>
      </div>
    </mat-card>
  </div>
  <div mat-dialog-actions>
    <button
      mat-flat-button
      color="primary"
      type="submit"
      (click)="doAction()"
      class="form d-flex flex-column flex-lg-row"
      [disabled]="
        entityForm.invalid && action !== 'Edit' && action !== 'Delete'
      "
    >
      {{ action }}
    </button>
    <button
      mat-button
      (click)="closeDialog()"
      mat-flat-button
      color="accent"
      type="button"
    >
      Cancel
    </button>
  </div>
</div>